{% extends "base.html" %}

{% block content %}
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <ul class="breadcrumb-list">
            <li>
                <a href="/"><img src="{{ url_for('static', filename='img/home.svg') }}" alt="" style="width:16px;height:16px;vertical-align:middle;margin-right:4px;">{{ t.NAV_HOME }}</a>
            </li>
            <li class="breadcrumb-separator">></li>
            <li class="current">{{ t.INDEX_HEADER }}</li>
        </ul>
    </nav>

    <div class="container">

    <!-- Live Status (volle Breite) -->
    <div class="live-status-wrapper">
        <div class="card live-status-card" id="live-status-card">
            <h2>Live Status</h2>
            <div class="info-row">
                <span class="info-label">{{ t.INDEX_HEADER }}</span>
                <span class="info-value" id="live-status-text">
                    <span class="status-indicator {% if live_status.status == 'copying' %}copying{% elif service_running %}stopped{% else %}stopped{% endif %}" id="live-status-indicator"></span>
                    <span id="live-status-label">{{ status_text }}</span>
                </span>
            </div>
            <div class="info-row inactive" id="disc-medium-row">
                <span class="info-label">Medium</span>
                <span class="info-value" id="disc-medium">-</span>
            </div>
            <div class="info-row inactive" id="disc-mode-row">
                <span class="info-label">Modus</span>
                <span class="info-value" id="disc-mode">-</span>
            </div>
            <div class="info-row inactive" id="progress-row">
                <span class="info-label">{{ t.INDEX_PROGRESS }}</span>
                <span class="info-value"><span id="progress-percent">0</span>% (<span id="progress-mb">0</span> / <span id="total-mb">0</span> <span id="progress-unit">MB</span>)</span>
            </div>
            <div class="progress-bar inactive" id="progress-bar" data-label="0%">
                <div class="progress-background-copying"></div>
                <div class="progress-overlay-copying" style="width: 100%"></div>
            </div>
            <div class="info-row inactive" id="eta-row">
                <span class="info-label">{{ t.INDEX_TIME }}</span>
                <span class="info-value" id="eta-text">-</span>
            </div>
        </div>
    </div>
    
    <!-- Speicherplatz und ISO Archive (zweispaltig) -->
    <div class="two-column-grid">
        <!-- Speicherplatz -->
        <div class="card">
            <h2>{{ t.INDEX_TARGET }}</h2>
            <div class="info-row">
                <span class="info-label">{{ t.SYSTEM_OUTPUT_DIR }}</span>
                <span class="info-value">{{ config.output_dir }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">{{ t.INDEX_SIZE }}</span>
                <span class="info-value">{{ disk_space.free_gb }} GB frei / {{ disk_space.total_gb }} GB</span>
            </div>
            <div class="progress-bar" data-label="{{ disk_space.used_percent }}% belegt">
                <div class="progress-background"></div>
                <div class="progress-overlay" style="width: {{ disk_space.free_percent }}%"></div>
            </div>
        </div>
        
        <!-- Archive -->
        <div class="card">
            <h2>{{ t.ARCHIVE_TITLE }}</h2>
            <div class="info-row">
                <span class="info-label">{{ t.ARCHIVE_FILTER_DATA }}</span>
                <span class="info-value">{{ archive_counts.data }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">{{ t.ARCHIVE_FILTER_CD }}</span>
                <span class="info-value">{{ archive_counts.audio }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">{{ t.ARCHIVE_FILTER_DVD }}</span>
                <span class="info-value">{{ archive_counts.dvd }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">{{ t.ARCHIVE_FILTER_BLURAY }}</span>
                <span class="info-value">{{ archive_counts.bluray }}</span>
            </div>
        </div>
    </div>
    
    <!-- Services (dreispaltig) -->
    <div class="three-column-grid">
        <!-- disk2iso Service -->
        <div class="card">
            <h2>
                disk2iso Service
                <button class="btn-restart-service-small" onclick="restartServiceHome('disk2iso')" title="Service neu starten">
                    <img src="{{ url_for('static', filename='img/refresh.svg') }}" style="width:14px;height:14px;">
                </button>
            </h2>
            <div class="info-row">
                <span class="info-label">{{ t.INDEX_STATE }}</span>
                <span class="info-value">
                    <span class="status-indicator {{ 'running' if disk2iso_status.running else 'stopped' }}" id="disk2iso-indicator"></span>
                    <span id="disk2iso-status">{{ 'Running' if disk2iso_status.running else 'Stopped' }}</span>
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">{{ t.SYSTEM_SERVICE_STATUS }}</span>
                <span class="badge {{ 'success' if disk2iso_status.status == 'active' else ('error' if disk2iso_status.status == 'error' else 'warning') }}" id="disk2iso-badge">
                    {% if disk2iso_status.status == 'active' %}{{ t.SERVICE_STATUS_ACTIVE }}
                    {% elif disk2iso_status.status == 'inactive' %}{{ t.SERVICE_STATUS_INACTIVE }}
                    {% elif disk2iso_status.status == 'error' %}{{ t.SERVICE_STATUS_ERROR }}
                    {% else %}{{ t.SERVICE_STATUS_NOT_INSTALLED }}{% endif %}
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">{{ t.LOGS_TIMESTAMP }}</span>
                <span class="info-value" id="disk2iso-updated">{{ current_time }}</span>
            </div>
        </div>
        
        <!-- WEB-UI Service -->
        <div class="card">
            <h2>
                WEB-UI Service
                <button class="btn-restart-service-small" onclick="restartServiceHome('disk2iso-web')" title="Service neu starten">
                    <img src="{{ url_for('static', filename='img/refresh.svg') }}" style="width:14px;height:14px;">
                </button>
            </h2>
            <div class="info-row">
                <span class="info-label">{{ t.INDEX_STATE }}</span>
                <span class="info-value">
                    <span class="status-indicator {{ 'running' if webui_status.running else 'stopped' }}" id="webui-indicator"></span>
                    <span id="webui-status">{{ 'Running' if webui_status.running else 'Stopped' }}</span>
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">{{ t.SYSTEM_SERVICE_STATUS }}</span>
                <span class="badge {{ 'success' if webui_status.status == 'active' else ('error' if webui_status.status == 'error' else 'warning') }}" id="webui-badge">
                    {% if webui_status.status == 'active' %}{{ t.SERVICE_STATUS_ACTIVE }}
                    {% elif webui_status.status == 'inactive' %}{{ t.SERVICE_STATUS_INACTIVE }}
                    {% elif webui_status.status == 'error' %}{{ t.SERVICE_STATUS_ERROR }}
                    {% else %}{{ t.SERVICE_STATUS_NOT_INSTALLED }}{% endif %}
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">{{ t.LOGS_TIMESTAMP }}</span>
                <span class="info-value" id="webui-updated">{{ current_time }}</span>
            </div>
        </div>
        
        <!-- MQTT Service -->
        <div class="card">
            <h2>MQTT Service</h2>
            <div class="info-row">
                <span class="info-label">{{ t.INDEX_STATE }}</span>
                <span class="info-value">
                    <span class="status-indicator {{ 'running' if mqtt_status.running else 'stopped' }}" id="mqtt-indicator"></span>
                    <span id="mqtt-status">{{ 'Running' if mqtt_status.running else 'Stopped' }}</span>
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">{{ t.SYSTEM_SERVICE_STATUS }}</span>
                <span class="badge {{ 'success' if mqtt_status.status == 'active' else ('error' if mqtt_status.status == 'error' else 'warning') }}" id="mqtt-badge">
                    {% if mqtt_status.status == 'active' %}{{ t.SERVICE_STATUS_ACTIVE }}
                    {% elif mqtt_status.status == 'inactive' %}{{ t.SERVICE_STATUS_INACTIVE }}
                    {% elif mqtt_status.status == 'error' %}{{ t.SERVICE_STATUS_ERROR }}
                    {% else %}{{ t.SERVICE_STATUS_NOT_INSTALLED }}{% endif %}
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">{{ t.LOGS_TIMESTAMP }}</span>
                <span class="info-value" id="mqtt-updated">{{ current_time }}</span>
            </div>
        </div>
    </div>
    
    <!-- MusicBrainz Album-Auswahl Modal -->
    <div id="musicbrainz-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>{{ t.MUSICBRAINZ_SELECT_TITLE }}</h2>
                <button class="close-modal" onclick="closeMusicBrainzModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p id="mb-message">{{ t.MUSICBRAINZ_SELECT_MESSAGE }}</p>
                <div id="mb-releases-list"></div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #444;">
                    <h3>{{ t.MUSICBRAINZ_MANUAL_TITLE }}</h3>
                    <div class="form-group">
                        <label>{{ t.MUSICBRAINZ_MANUAL_ARTIST }}</label>
                        <input type="text" id="manual-artist" class="form-input" />
                    </div>
                    <div class="form-group">
                        <label>{{ t.MUSICBRAINZ_MANUAL_ALBUM }}</label>
                        <input type="text" id="manual-album" class="form-input" />
                    </div>
                    <div class="form-group">
                        <label>{{ t.MUSICBRAINZ_MANUAL_YEAR }}</label>
                        <input type="text" id="manual-year" class="form-input" placeholder="YYYY" />
                    </div>
                    <button onclick="submitManualMetadata()" class="btn btn-primary">
                        {{ t.MUSICBRAINZ_MANUAL_BUTTON }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/index.js') }}?v=1768148211"></script>
    <script src="{{ url_for('static', filename='js/musicbrainz.js') }}?v={{ current_time }}"></script>
{% endblock %}

